(* ::Package:: *)

BeginPackage["CardReader`"];
ansers::usage="ansers[region]";
showSelect::usage="showSelect[i],\:663e\:793a\:6240\:6709\:6d82\:9ed1\:90e8\:5206\:7684\:56fe\:50cf\:53ca\:5176\:9762\:79ef";


Begin["`Private`"]


splitNPart[i_,n_]:=With[{idata=ImageData[i]},
	With[{w=Dimensions[idata][[2]]},
		Table[ImageTake[i,{1,All},{(k-1)*w/n,k*w/n}],{k,1,n}]]
]


(*\:9762\:79ef\:6700\:5927\:7684*)
maxArea[i_]:=ComponentMeasurements[i,{"Shape","Area"},CornerNeighbors->False]//SortBy[#,#[[2,2]]&]&//Reverse//First//#[[2]]&


(*\:663e\:793a\:6240\:6709\:6d82\:9ed1\:90e8\:5206\:7684\:56fe\:50cf\:53ca\:5176\:9762\:79ef*)
showSelect[i_]:=i//Binarize//ColorNegate//ComponentMeasurements[#,{"Shape","Area"}]&//Select[#,#[[2,2]]>1000&]&


imageLines[i_]:=i//Binarize//ColorNegate//ImageData//SplitBy[#,MatchQ[#,{0..}]&]/.{{0..}..}->Sequence[]& //Image[#,"Bit",Magnification->1]&/@#&


(*\:5e03\:5c14\:6570\:7ec4\:8f6cABCD\:6570\:7ec4*)
bools2abcds[bools_]:=With[{abcd={"A","B","C","D"}},MapIndexed[If[#1==True,abcd[[#2[[1]]]],Null]&,bools]//#/.Null->Sequence[]&]


ansers[region_]:=With[{iregion=Binarize@region},
(
selectImages=iregion//imageLines//Rest//ImageCrop/@#&;
selectMatrixs=selectImages//splitNPart[#,5]&/@#&//Transpose;
(*\:662f\:5426\:88ab\:6d82\:9ed1\:4e86*)
SelectQ[i_]:=i//maxArea//#[[2]]&//#>1000&;
selectBoolMatrix=Table[selectMatrixs[[row,col]]//SelectQ,{row,5},{col,4}];
numberBoolMatrix=MapIndexed[#2[[1]]->#1&,selectBoolMatrix];
(*\:9009\:4e2d\:7684\:7b54\:6848*)
ansersVector[numberBoolMatrix_]:=numberBoolMatrix//#[[1]]->bools2abcds[#[[2]]]&/@#&;
ansersVector@numberBoolMatrix
)
]
(*ansers@\!\(\*
GraphicsBox[
TagBox[RasterBox[CompressedData["
1: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
6Mb/ANqt2ok=
"], {{0, 293}, {568, 0}}, {0, 255},
ColorFunction->RGBColor],
BoxForm`ImageTag["Byte", ColorSpace -> "RGB", Interleaving -> True],
Selectable->False],
BaseStyle->"ImageGraphics",
ImageSize->Automatic,
ImageSizeRaw->{568, 293},
PlotRange->{{0, 568}, {0, 293}}]\)*)


End[ ];


EndPackage[ ]
